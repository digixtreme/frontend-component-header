{"version":3,"file":"SelectMenu.js","names":["React","useState","useEffect","useCallback","PropTypes","classNames","ExpandMore","Button","ModalPopup","useToggle","Menu","SELECT_MENU_DEFAULT_MESSAGE","SelectMenu","_ref","defaultMessage","isLink","children","className","props","_objectWithoutProperties","_excluded","triggerTarget","useRef","focusMenuRef","itemsCollection","useMemo","Array","from","length","map","createRef","defaultIndex","i","defaultSelected","undefined","selected","setSelected","isOpen","open","close","vertOffset","setOffset","createMenuItems","Children","child","index","newProps","onClick","e","current","id","toString","role","cloneElement","link","prevOpenRef","numItems","boundingRect","parentElement","getBoundingClientRect","bottom","window","innerHeight","top","scrollIntoView","block","focus","preventScroll","createElement","_extends","ref","variant","iconAfter","placement","positionRef","onClose","modifiers","name","enabled","options","offset","offsetWidth","key","propTypes","string","bool","node","isRequired","defaultProps"],"sources":["../../src/Menu/SelectMenu.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { ExpandMore } from '../../icons';\nimport Button from '../Button';\nimport ModalPopup from '../Modal/ModalPopup';\nimport useToggle from '../hooks/useToggle';\nimport Menu from '.';\n\nexport const SELECT_MENU_DEFAULT_MESSAGE = 'Select...';\n\nfunction SelectMenu({\n  defaultMessage,\n  isLink,\n  children,\n  className,\n  ...props\n}) {\n  const triggerTarget = React.useRef(null);\n  // this ref is used to focus the menu open button after any menu option is clicked.\n  // triggerTarget.current.focus() inside the onCLick() function didn't guarantee element focus.\n  const focusMenuRef = React.useRef(false);\n  const itemsCollection = React.useMemo(\n    () => Array.from({ length: children.length }).map(() => React.createRef()),\n    [children.length],\n  );\n\n  const defaultIndex = useCallback(() => {\n    for (let i = 0; i < children.length; i++) {\n      if (children[i].props && children[i].props.defaultSelected) {\n        return i;\n      }\n    }\n    return undefined;\n  }, [children]);\n\n  const [selected, setSelected] = useState(defaultIndex());\n  const [isOpen, open, close] = useToggle(false);\n  const [vertOffset, setOffset] = useState(0);\n\n  const createMenuItems = () => React.Children.map(children, (child, index) => {\n    const newProps = {\n      onClick(e) {\n        if (child.props.onClick) {\n          child.props.onClick(e);\n        }\n        setSelected(index);\n        close();\n        focusMenuRef.current = true;\n      },\n      id: `${index.toString()}_pgn__menu-item`,\n      role: 'link',\n    };\n    if (selected === index) {\n      newProps['aria-current'] = 'page';\n    }\n    return React.cloneElement(child, newProps);\n  });\n\n  const link = isLink; // allow inline link styling\n  const prevOpenRef = React.useRef();\n\n  useEffect(() => {\n    // logic to always center the selected item.\n    if (isOpen && selected) {\n      const numItems = children.length;\n      const boundingRect = itemsCollection[selected].current.parentElement.getBoundingClientRect();\n      if (boundingRect.bottom >= window.innerHeight - 150 || boundingRect.top <= 150) {\n        setOffset(0); // if too close to the edge, don't do centering fancyness\n      } else {\n        switch (true) {\n          case numItems < 6: {\n            // on small lists, center each element\n            setOffset(\n              (selected) * -48,\n            );\n            break;\n          }\n          case selected < 2: {\n            // On first two elements, set offset based on position\n            setOffset((selected) * -48);\n            break;\n          }\n          case numItems - selected < 3: {\n            // on n-1 and n-2 elelements, set offset to put most modal elements on top.\n            setOffset((6 - (numItems - selected)) * -48);\n            break;\n          }\n          case selected > 1 && numItems - selected > 2: {\n            // on \"middle elements\", set offset to center of block and scroll to center\n            itemsCollection[selected].current.children[0].scrollIntoView({\n              block: 'center',\n            });\n            setOffset(2 * -48);\n            break;\n          }\n          default: break;\n        }\n      }\n    }\n    // set focus on open\n    if (isOpen && !prevOpenRef.current && selected) {\n      itemsCollection[selected].current.children[0].focus({ preventScroll: (defaultIndex() === selected) });\n    }\n    if (focusMenuRef.current) {\n      triggerTarget.current.focus();\n      focusMenuRef.current = false;\n    }\n    prevOpenRef.current = isOpen;\n  }, [isOpen, children.length, defaultIndex, itemsCollection, selected]);\n\n  return (\n    <div className={classNames('pgn__menu-select', className)} {...props}>\n      <Button\n        aria-haspopup=\"true\"\n        aria-expanded={isOpen}\n        ref={triggerTarget}\n        variant={link ? 'link' : 'outline-primary'}\n        iconAfter={ExpandMore}\n        onClick={open}\n      >\n        {selected !== undefined && children[selected] ? children[selected].props.children : defaultMessage}\n      </Button>\n      <div className=\"pgn__menu-select-popup\">\n        <ModalPopup\n          placement=\"right-start\"\n          positionRef={triggerTarget}\n          isOpen={isOpen}\n          onClose={close}\n          modifiers={\n            [\n              {\n                name: 'flip',\n                enabled: true,\n              },\n              {\n                name: 'offset',\n                options: {\n                  enabled: true,\n                  offset: [vertOffset, triggerTarget.current ? -1 * triggerTarget.current.offsetWidth : 0],\n                },\n              },\n            ]\n          }\n        >\n          <Menu aria-label=\"Select Menu\">\n            {createMenuItems().map((child, index) => (\n              <div key={child.props.id} ref={itemsCollection[index]}>\n                {child}\n              </div>\n            ))}\n          </Menu>\n        </ModalPopup>\n      </div>\n    </div>\n  );\n}\n\nSelectMenu.propTypes = {\n  /** String that is displayed for default value of the ``SelectMenu`` */\n  defaultMessage: PropTypes.string,\n  /** Displays chosen value of the ``SelectMenu`` as a link */\n  isLink: PropTypes.bool,\n  /** Specifies the content of the ``SelectMenu`` */\n  children: PropTypes.node.isRequired,\n  /** Specifies class name to append to the base element */\n  className: PropTypes.string,\n};\n\nSelectMenu.defaultProps = {\n  defaultMessage: SELECT_MENU_DEFAULT_MESSAGE,\n  isLink: false,\n  className: undefined,\n};\n\nexport default SelectMenu;\n"],"mappings":"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"}